# Subdomain Proxies

## **4.3 Subdomain Proxies**

At the beginning of this chapter, we showed you a table of possible outcomes of same-
origin policy checks against different origins. If you look back at table 4.1, you’ll

notice the SOP is strict when it comes to the host part of the origin. Both example.com
and sub.example.com share the same higher-level domain, but the browser considers
them to be completely unrelated to each other.
Fortunately for us, browsers allow websites to change the host part of their origins
to the suffix of their original values. This means that a page hosted on sub.example
.com can set its origin to example.com, but it can’t set it to alt.example.com or
google.com. Note that this exception applies to the domain part only. Browsers won’t
let you modify the origin’s port number or HTTP protocol.
If you’re an astute reader, you may have figured out how to turn this exception to
your advantage. If both communicating parties opt in to the same domain suffix,
they’ll have the same origin values, and browsers will no longer prevent them from
communicating with each other. In other words, documents on sub.example.com and
alt.example.com are prohibited from accessing each other’s properties and methods
unless they explicitly opt in to the same higher-level domain (example.com, in this example).

Of course, these are all subdomains under our control. How can you use this technique if you’re distributing your application to publishers on entirely different domains?

Let’s say you’re developing a widget for a small number of large, corporate publishers, over which you have influence or control of their production environment.

You could ask these publishers to create a subdomain under their base-level domain and have point it to your servers. For example, a publisher at publisher.com would create the subdomain thirdparty.publisher.com. They can do this by configuring their web server to proxy all requests to that subdomain to your servers (see figure 4.4), or have it done at the DNS level by using a CNAME record. Afterward, your third-party script executing on publisher.com can communicate through this subdomain to initiate AJAX requests to your main server. Subdomain proxies require some work on behalf of your customers, but it’s a real-world practice used by a number of successful third-party applications today.

Now that you know the theory, it’s time to see some code. In this section, we’ll implement subdomain proxies as a means of enabling cross-domain communication for your third-party application. We’ll finish with a discussion of subdomain proxy browser quirks and other limitations.

## **Sub-chapters**

- [[1_document-domain]]
- [[2_cross-origin-subdomain-proxies]]
- [[3_sub-domain-jsonp-proxies]]
- [[4_ie-subdomain-proxies]]
- [[5_security-implications]]

---

#### From [[_server-com]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[1_document-domain]: 1_document-domain "document.domain"
[2_cross-origin-subdomain-proxies]: 2_cross-origin-subdomain-proxies "Cross-origin Sub-domain Proxies"
[3_sub-domain-jsonp-proxies]: 3_sub-domain-jsonp-proxies "Sub-domain JSONP Proxies"
[4_ie-subdomain-proxies]: 4_ie-subdomain-proxies "IE Sub-domain Proxies"
[5_security-implications]: 5_security-implications "Security Implications"
[_server-com]: ../_server-com "4️⃣ Server Com"
[//end]: # "Autogenerated link references"
