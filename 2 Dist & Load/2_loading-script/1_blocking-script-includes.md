# Blocking Script Includes

## 2.2.1 Blocking Script Includes

Let’s start with the basics. You should already be familiar with how to load scripts using

the standard HTML <script> tag. Using it to load your initial script file is straightfor-
ward: just give publishers a standard <script> tag to paste into their HTML source

code whose src attribute points to your JavaScript file. This is the simplest, smallest

amount of code you could give to your publishers. If you recall, we used this in chap-
ter 1 in the weather widget example.

Here’s what a standard script include would look like to load a single instance of
the product widget:

<script src="http://camerastork.com/widget.js?product=1234"></script>

The src attribute points to a JavaScript file, widget.js, that’s hosted on your servers at
http://camerastork.com. Embedded in the URL’s query string is a product ID. This
ID is how you’ll identify which product to render on the publisher’s page. Pretty
straightforward.
There’s no question this method will achieve the desired effect of loading your
script on the publisher’s page, but it comes with a major drawback. A regular

<script> tag include like this is considered blocking or synchronous. This means that

the browser will stop processing the page while it waits for the script file to be down-
loaded and executed. This is because the script might modify the page contents using

document.write. The browser can’t safely continue processing until any and all out-
put from document.write has been captured.

This is illustrated in the following example HTML. The browser waits for widget.js
to finish before rendering the header or executing application.js:
<body>
<script
src="http://camerastork.com/widget.js?product=1234"></script>
<p>Hello, world</p>
<script src="/application.js"></script>
</body>

Blocking script elements can slow down publishers’ pages because they stop the
browser from continuing if the target file is slow to download—or worse, unavailable.
The higher the publisher places the script include in their HTML source, the more
pronounced the effect. For example, if the publisher decides to place the widget at

the top of their website, the remainder of the page won’t get rendered until the wid-
get script file loads. The worst possible result is if the publisher adds your script

include to their <head> section. This could block the browser from reaching the

<body> tag, such that visitors will be stuck with a blank page until the script resolves.
LIMITING THE IMPACT OF BLOCKING SCRIPTS
One way to limit the effect of blocking scripts is to advise publishers to place the script
include at the end of their HTML source. That way, if your script is slow, it won’t matter
(as much) because the browser has already rendered the page. The downside is that

you can’t rely on the script element’s position in the DOM to determine where to ren-
der your widget. But you can always ask publishers to identify the target render loca-
tion separately using a uniquely identified element:

<body>
<div id="camerastork-widget"/>
<p>Hello, world</p>
<script
src="http://camerastork.com/widget.js?product=1234"></script>
</body>
In this example, when widget.js loads, it’ll render the product widget and append it to
the <div> element with id="camerastork-widget". From a performance perspective,
this is better than the earlier script include, because it doesn’t block the publisher’s
page (although the total load time will be about the same). But this is contingent on
the publisher correctly placing the script include at the end of their HTML source.
And experience tells us this isn’t always a given.

The bigger takeaway is that if widget.js isn’t outputting HTML in-place, it’s not mak-
ing use of document.write. And if widget.js isn’t using document.write, the browser

should theoretically not have to pause rendering while it’s executing. But unfortu-
nately the browser doesn’t know this; only we do. What if there were a way to tell the

browser that our script can be loaded without blocking the page?

---

#### From [[_2_loading-script]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[_2_loading-script]: _2_loading-script "Loading Script"
[//end]: # "Autogenerated link references"
