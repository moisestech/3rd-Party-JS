# Append Known Local

## **3.1.2 Appending to a known location**

We feel the best way to render markup on the publisher’s page is to convert your
HTML string to DOM elements, and then append them to an element that already
exists on the publisher’s page. This method works whether you’re using blocking
script includes or asynchronous script includes. It’s win-win.

To do this, you need to first create a container element using document.create-
Element. This element will hold the HTML that composes the widget. To do that,

you’ll assign the HTML string to the container element’s innerHTML property:

```html
var html = '
<div>
  ' + '
  <h3>Mikon E90 Digital SLR</h3>
  ' + ' <img src="http://camerastork.com/img/1337-small.jpg" />' + '
  <p>$599.99</p>
  ' + '
  <p>4.3/5.0 &bull; 176 Reviews</p>
  ' + '
</div>
'; var div = document.createElement('div'); div.innerHTML = html;
```

At this point you have a <div> container element that holds your widget’s markup. All
that remains is to append this element to the publisher’s page. But where to append
it? The most common use case is to append to where the publisher has located the
script include snippet—the one that loads your application. To do that, you need to
first locate the script include snippet on the page.

JAVASCRIPT TEMPLATING LIBRARIES Once upon a time, JavaScript developers
used to write HTML directly in their JavaScript files—like in the examples
we’ve shown you so far. Alas, string concatenation isn’t JavaScript’s strong
suit, and these HTML snippets can become tedious to write and maintain.
Instead, most developers use JavaScript templating libraries, which allow you

to write your HTML in a templating language explicitly designed for generat-
ing markup. There are a variety of templating libraries out there, but we rec-
ommend looking at Mustache.js and its spin-offs, Handlebars.js and Hogan.js.

LOCATING THE SCRIPT INCLUDE SNIPPET
In order to locate your script’s include snippet, it needs to be uniquely identifiable on
the DOM in some way. One way you can do this is by adding a predefined ID, class, or
data-\* attribute to the include snippet’s <script> tag. Then, you merely need to query
the DOM for this identifying attribute in order to locate the script element.
Consider this asynchronous script include snippet for the Camera Stork widget,
which passes the product ID as part of the query string. This snippet now carries a
unique ID, stork-widget, as part of the containing <script> tag.

**Listing 3.1 The script include snippet, now with a unique ID**

```html
<script id="stork-widget">
  (function () {
    var script = document.createElement("script");
    script.async = true;
    script.src = "http://camerastork.com/widget.js?product=1234";
    var entry = document.getElementsByTagName("script")[0];
    entry.parentNode.insertBefore(script, entry);
  })();
</script>
```

After the widget code is loaded, it’s easy to identify the script include on the DOM
using document.getElementById. Get a reference to the script element, and then
insert your newly created container element before it:

var appendTo = document.getElementById('stork-widget');
appendTo.parentNode.insertBefore(div, appendTo);
Of course, by using an ID like this to identify the include widget, you’ll only be able to
have one widget rendered per page. This is because querying by ID will always return

the first instance of the script include snippet with that ID, so any subsequent snippets
will end up targeting the wrong render location.
Now, many third-party applications may never intend to support multiple instances
per page, in which case you’re fine to stick with what we’ve just covered. But for the

Camera Stork widget, this is a scenario you should support. Ideally, you want the pub-
lisher to include as many Camera Stork widget instances as they can fit on a page, in

order to help you promote as many of your products as possible. Let’s look at ways to
make that happen.

---

### From [[_1_outputting-html]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[_1_outputting-html]: _1_outputting-html "Outputting HTML"
[//end]: # "Autogenerated link references"
