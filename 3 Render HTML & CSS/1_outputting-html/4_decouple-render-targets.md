# Decouple Render Targets

## 3.1.4 Decoupling Render Targets

So far, we’ve been talking about loading multiple instances of a widget by including multiple script include snippets on the same page. This is a flexible solution that works for widgets like Camera Stork—applications that can have multiple instances on the page. That said, this implementation has a significant inefficiency: the publisher must redundantly load your application code for each instance of the Camera Stork widget, even when the code has already been loaded on the page.

To avoid this situation you can decouple the target render location from your script include snippet by having the publisher specify targets separately. This means your application can render multiple widget instances despite loading your application code only once.

To do this, again you’ll have publishers use custom data-\* attributes to denote the target render location. But this time these data attributes can be placed completely separately from the script include snippet. The example code in the following listing specifies two render locations, but uses a single script include snippet.

**Listing 3.3 The Script Include Snippet with Separately Defined Render Target Locations**

```html
<div data-stork-product="1337"></div>
<div data-stork-product="2012"></div>
<script>
  (function () {
    var script = document.createElement("script");
    script.async = true;
    script.src = "http://camerastork.com/widget.js";
    var entry = document.getElementsByTagName("script")[0];
    entry.parentNode.insertBefore(script, entry);
  })();
</script>
```

You’ll notice that the script include snippet doesn’t declare any product identifying parameters. It doesn’t have to: the product ID parameter is available via the data-stork-product attribute. Your application code merely needs to query the DOM for all instances of the data-stork-product attribute, extract the product ID, and render the matching product at that location:

```javascript
jQuery("[data-stork-product]").each(function () {
  var location = jQuery(this);
  location.removeAttr("data-stork-product");
  var id = location.attr("data-stork-product");
  getWidgetData(id, function (data) {
    renderWidget(data, location);
  });
});
```

You’ll notice that, just like our earlier examples, the data-stork-product attribute is removed from the DOM after each render. Even though it’s no longer required that your publisher include multiple script includes in their HTML source to render multiple widgets, in this copy-paste world we live in, they might do so anyway. In that case, you don’t want to insert duplicate copies of your widget when any subsequent scripts get executed.

Alternatively, you can just have your code exit early in the event that it is loaded a second time.

---

### From [[_1_outputting-html]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[_1_outputting-html]: _1_outputting-html "Outputting HTML"
[//end]: # "Autogenerated link references"
