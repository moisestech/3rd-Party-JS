# window.postMessage

## **5.1.1 Sending messages using window.postMessage**

Using window.postMessage is pretty straightforward. In order to send a message, you call the postMessage method on the target window you want to receive a message.

The target window can be the global window object (the window context where your script is executing) or any of the following possible recipients:

- Iframes created within your document window:
  `var iframe = document.getElementById('my-iframe');`
  `var win = iframe.documentWindow;`

- Pop-up windows that you’ve opened with JavaScript:
  `var win = window.open(...);`

- The window that contains your document window:
  `var win = window.parent;`

- And the window that opened your document:
  `var win = window.opener;`

After you have a reference to the target Window object, you can send messages to that window by calling a special postMessage function on that object. This function accepts two formal parameters: data to send (the message body) and the target’s origin value:

```javascript
Window {
void postMessage(any message, string targetOrigin)
}
```

With this signature in mind, 2 you can now send your first message. Here’s a quick example where the message body is Hello, World!, the target origin is thirdpartyjs.com, and the Window object is referenced by a variable win:

`win.postMessage('Hello, World!', 'http://thirdpartyjs.com/');`

The definition of origin here is exactly the same as in chapter 4—a combination of protocol, hostname, and port that uniquely identifies the host you’re trying to communicate with. The target’s origin value defines a filter for the browser to use to select recipients for your message. Messages are delivered to the recipient window only if the recipient’s origin value matches exactly the value specified in the window.post-Message call. Otherwise, the browser will throw an exception and your message will go straight to /dev/null.

**WILDCARD ORIGINS**

- If you don’t know the origin value of your postMessage recipient (or you don’t care), you can set the second parameter to an asterisk (\*) wildcard. This will cause postMessage to skip origin checks when sending cross-domain messages. Of course, you should use this wildcard approach only when you’re absolutely certain that it’s acceptable for any document to receive your message. Always keep in mind that browser windows and iframes can be redirected at any time; it’s possible that the document you trust can be changed to some other random document without you even knowing about it.

- Initially, window.postMessage API implementations only allowed you to send string messages. This meant that any complex data structures had to be serialized into strings (JSON) in order to transmit them as messages. But the latest versions of modern browsers allow you to pass a broad variety of data objects natively. Browsers automatically serialize such objects using what’s called the structured clone algorithm—a new algorithm defined by the HTML5 specification that helps with serializing complex JavaScript objects.

**JSON VERSUS THE STRUCTURED CLONE ALGORITHM Though JSON** is the de facto standard for serializing JavaScript objects into strings (and vice versa), it can’t convert complicated data types like RegExp, Blob, File, and ImageData. The structured clone algorithm was designed to handle these complex cases. The authors behind the implementation also state that, in some circumstances, the structured clone algorithm may be more efficient than JSON serialization.

- But what JSON loses in flexibility and performance, it gains in compatibil- ity. The structured clone algorithm isn’t implemented in all browsers—including IE8 and IE9—whereas any browser can serialize and parse JSON. For this reason we advocate using JSON in conjunction with window.postMessage.

- The window.postMessage function is simple to use, and this small section covers most of it. But recognize that it only covers one half of the messaging problem: sending messages. Let’s now look at how a window receives messages.

---

#### From [[_1_windows-message-api]]

[//begin]: # "Autogenerated link references for markdown compatibility"
[_1_windows-message-api]: _1_windows-message-api "Windows Message API"
[//end]: # "Autogenerated link references"
